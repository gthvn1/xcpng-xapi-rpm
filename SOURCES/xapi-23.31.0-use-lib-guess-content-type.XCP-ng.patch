https://github.com/xapi-project/xen-api/pull/5541

diff --git i/ocaml/xapi/dune w/ocaml/xapi/dune
index 45d5e67aa..907cde4d1 100644
--- i/ocaml/xapi/dune
+++ w/ocaml/xapi/dune
@@ -73,6 +73,7 @@
     hex
     http_lib
     ipaddr
+    magic-mime
     message-switch-core
     message-switch-unix
     mirage-crypto
diff --git i/ocaml/xapi/fileserver.ml w/ocaml/xapi/fileserver.ml
index 1c4cf9520..ed9ed334d 100644
--- i/ocaml/xapi/fileserver.ml
+++ w/ocaml/xapi/fileserver.ml
@@ -42,40 +42,8 @@ let missing uri =
   ^ " was not found on this server.</p> <hr><address>Xapi \
      Server</address></body></html>"

-let get_extension filename =
-  try
-    let basename = Filename.basename filename in
-    let i = String.rindex basename '.' in
-    Some (String.sub basename (i + 1) (String.length basename - i - 1))
-  with _ -> None
-
-let application_octet_stream = "application/octet-stream"
-
-let mime_of_extension = function
-  | "html" | "htm" ->
-      "text/html"
-  | "css" ->
-      "text/css"
-  | "js" ->
-      "application/javascript"
-  | "gif" ->
-      "image/gif"
-  | "png" ->
-      "image/png"
-  | "jpg" | "jpeg" ->
-      "image/jpeg"
-  | "xml" ->
-      "application/xml"
-  | "rpm" ->
-      "application/x-rpm"
-  | _ ->
-      application_octet_stream
-
 let response_file s file_path =
-  let mime_content_type =
-    let ext = Option.map String.lowercase_ascii (get_extension file_path) in
-    Option.fold ~none:application_octet_stream ~some:mime_of_extension ext
-  in
+  let mime_content_type = Magic_mime.lookup file_path in
   let hsts_time = !Xapi_globs.hsts_max_age in
   Http_svr.response_file ~mime_content_type ~hsts_time s file_path

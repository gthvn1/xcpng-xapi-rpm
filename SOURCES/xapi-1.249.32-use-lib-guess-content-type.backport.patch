https://github.com/xapi-project/xen-api/pull/5541

diff --git i/ocaml/xapi/dune w/ocaml/xapi/dune
index 2c169cc3a..41bcf2a67 100644
--- i/ocaml/xapi/dune
+++ w/ocaml/xapi/dune
@@ -49,6 +49,7 @@
    ezxenstore.core
    gencertlib
    ipaddr
+   magic-mime
    message-switch-unix
    mtime
    mtime.clock.os
diff --git i/ocaml/xapi/fileserver.ml w/ocaml/xapi/fileserver.ml
index 49b871e31..6b819c6ed 100644
--- i/ocaml/xapi/fileserver.ml
+++ w/ocaml/xapi/fileserver.ml
@@ -44,41 +44,8 @@ let missing uri =
   ^ " was not found on this server.</p> <hr><address>Xapi \
      Server</address></body></html>"

-let get_extension filename =
-  try
-    let basename = Filename.basename filename in
-    let i = String.rindex basename '.' in
-    Some (String.sub basename (i + 1) (String.length basename - i - 1))
-  with _ -> None
-
-let application_octet_stream = "application/octet-stream"
-
-let mime_of_extension = function
-  | "html" | "htm" ->
-      "text/html"
-  | "css" ->
-      "text/css"
-  | "js" ->
-      "application/javascript"
-  | "gif" ->
-      "image/gif"
-  | "png" ->
-      "image/png"
-  | "jpg" | "jpeg" ->
-      "image/jpeg"
-  | "xml" ->
-      "application/xml"
-  | "rpm" ->
-      "application/x-rpm"
-  | _ ->
-      application_octet_stream
-
 let response_file s file_path =
-  let mime_content_type =
-    let open Stdext.Opt in
-    let ext = map String.lowercase_ascii (get_extension file_path) in
-    default application_octet_stream (map mime_of_extension ext)
-  in
+  let mime_content_type = Magic_mime.lookup file_path in
   Http_svr.response_file ~mime_content_type s file_path

 let is_external_http req s =
